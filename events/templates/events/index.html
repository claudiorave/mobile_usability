<!DOCTYPE html>
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'events/style.css' %}">
<html>
<head>
    <meta charset="utf-8">
    <title>Mobile Logger</title>
</head>
<body>
<header>Mobile Logger</header>
<div class="buttonHolder"><a href="/reset">
    <button>RESET</button>
</a></div>
<script>
    const chatSocket = new WebSocket(
        'wss://'
        + window.location.host
        + '/ws/'
    );

    chatSocket.onmessage = function (e) {
        json = JSON.parse(e.data).message;
        console.log(new Date(json.timestamp));
        // Find a <table> element with id="myTable":
        var table = document.getElementById(json.type);

// Create an empty <tr> element and add it to the 1st position of the table:
        var row = table.insertRow(-1);

// Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
        if (json.type === "misclick") {
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);

// Add some text to the new cells:
            cell1.innerHTML = json.x;
            cell2.innerHTML = json.y;
            let datetime = new Date(json.timestamp);
            let formatted_date = datetime.getDate().toString().padStart(2, "0") + "-" + (datetime.getMonth() + 1).toString().padStart(2, "0") + "-" + datetime.getFullYear().toString().substr(-2) + " " + datetime.getHours() + ":" + datetime.getMinutes().toString().padStart(2, "0") + ":" + datetime.getSeconds().toString().padStart(2, "0")
            cell3.innerHTML = formatted_date;
            cell4.innerHTML = json.elements;
        } else if (json.type === "pinchzoom") {
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            let datetime = new Date(json.timestamp);
            let formatted_date = datetime.getDate().toString().padStart(2, "0") + "-" + (datetime.getMonth() + 1).toString().padStart(2, "0") + "-" + datetime.getFullYear().toString().substr(-2) + " " + datetime.getHours() + ":" + datetime.getMinutes().toString().padStart(2, "0") + ":" + datetime.getSeconds().toString().padStart(2, "0")
            cell1.innerHTML = formatted_date;
            cell2.innerHTML = json.elements;
        } else if (json.type === "scroll") {
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            let datetime = new Date(json.timestamp);
            let formatted_date = datetime.getDate().toString().padStart(2, "0") + "-" + (datetime.getMonth() + 1).toString().padStart(2, "0") + "-" + datetime.getFullYear().toString().substr(-2) + " " + datetime.getHours() + ":" + datetime.getMinutes().toString().padStart(2, "0") + ":" + datetime.getSeconds().toString().padStart(2, "0")
            cell1.innerHTML = new Date(formatted_date);
            cell2.innerHTML = json["scroll_points"];
            cell3.innerHTML = json["scroll_objects"];
        }
    };

    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
        const chatSocket = new WebSocket(
            'wss://'
            + window.location.host
            + '/ws/'
        );
    };
</script>
<section>
    <h2>MisClicks</h2>
    <table id="misclick">
        <th>
            x
        </th>
        <th>
            y
        </th>
        <th>
            timestamp
        </th>
        <th>
            elements
        </th>
        <tbody>
        {% for misclicks in misclicks_list %}
           {{ misclicks.id }}
            <tr>
                <td>{{ misclicks.x }}</td>
                <td>{{ misclicks.y }}</td>
                <td>{{ misclicks.timestamp }}</td>
                <td>{{ misclicks.elements }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
<section>
    <h2>PinchZoom</h2>
    <table id="pinchzoom">
        <th>
            timestamp
        </th>
        <th>
            elements
        </th>
        {% for pinchzoom in pinchzoom_list %}
            <tr>
                <td>{{ pinchzoom.timestamp }}</td>
                <td>{{ pinchzoom.elements }}</td>
            </tr>
        {% endfor %}
    </table>
</section>
<section>
    <h2>Scroll</h2>
    <table id="scroll">
        <th>
            timestamp
        </th>
        <th>
            scroll_points
        </th>
        <th>
            scroll_objects
        </th>
        {% for scroll in scroll_list %}
            <tr>
                <td>{{ scroll.timestamp }}</td>
                <td>{{ scroll.scroll_points }}</td>
                <td>{{ scroll.scroll_objects }}</td>
            </tr>
        {% endfor %}
    </table>
</section>

</body>
</html>