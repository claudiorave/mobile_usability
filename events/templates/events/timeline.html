<!DOCTYPE html>
{% load static %}


<html>
<head>
    <meta charset="utf-8">
    <title>Mobile Logger</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">



    <link rel="stylesheet" type="text/css" href="{% static 'events/style.css' %}">


</head>
<body>
<header class="h1">Mobile Logger</header>
<div class="btn-group mb-2" role="group" aria-label="Button group with nested dropdown">
    {% if request.path != "/" %}
        <a class="btn btn-primary" href="/reset{{ request.path }}/">
            RESET
        </a>
    {% else %}
        <a class="btn btn-primary" href="/reset/index/">
            RESET
        </a>
    {% endif %}

    <div class="btn-group" role="group">

        <div class="dropdown" id="drop">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                    data-bs-toggle="dropdown" aria-expanded="false">
                Vistas
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="/">Por evento</a></li>
                <li><a class="dropdown-item" href="/unificada">Unificada</a></li>
                <li><a class="dropdown-item" href="/timeline">Timeline</a></li>
            </ul>
        </div>
    </div>
</div>
<script>
    const chatSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/'
    );
    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
        const chatSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/'
        );
    };
</script>


<section id="timeline">
<div id="lineCont">
  <div id="line"></div>
  <div id="span">Date Placeholder</div>
</div>
<div id="mainCont">
</div>

</section>

<section>
    <h2 class="display-6">Device</h2>
    <table class="table-bordered" id="device">
        <th>
            phone
        </th>
        <th>
            mobile
        </th>
        <th>
            tablet
        </th>
        <th>
            user_agent
        </th>
        <th>
            build
        </th>
        <th>
            webkit
        </th>
        <th>
            os
        </th>
        <th>
            height
        </th>
        <th>
            width
        </th>
        {% if device != None %}

            <tr>
                <td>{{ device.phone }}</td>
                <td>{{ device.mobile }}</td>
                <td>{{ device.tablet }}</td>
                <td>{{ device.user_agent }}</td>

                <td>{{ device.build }}</td>

                <td>{{ device.webkit }}</td>

                <td>{{ device.os }}</td>

                <td>{{ device.height }}</td>

                <td>{{ device.width }}</td>


            </tr>
        {% endif %}
    </table>
</section>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script>$(function () {
  $('[data-toggle="popover"]').popover({html: true})
})
$('.dropdown-toggle').dropdown()

    </script>
<script>
    //Sample dates
var dates = ["6/12/2015", "8/15/2015", "10/22/2015", "12/21/2015", "12/22/2015"];
//For the purpose of stringifying MM/DD/YYYY date format
var monthSpan = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

//Format MM/DD/YYYY into string
function dateSpan(date) {
  var month = date.split('/')[0];
  month = monthSpan[month - 1];
  var day = date.split('/')[1];
  if (day.charAt(0) == '0') {
    day = day.charAt(1);
  }
  var year = date.split('/')[2];

  //Spit it out!
  return month + " " + day + ", " + year;
}

//Main function. Draw your circles.
function makeCircles() {
  //Forget the timeline if there's only one date. Who needs it!?
  if (dates.length < 2) {
    $("#line").hide();
    $("#span").show().text(dateSpan(dates[0]));
    //This is what you really want.
  } else if (dates.length >= 2) {
    //Set day, month and year variables for the math
    var first = dates[0];
    var last = dates[dates.length - 1];

    var firstMonth = parseInt(first.split('/')[0]);
    var firstDay = parseInt(first.split('/')[1]);

    var lastMonth = parseInt(last.split('/')[0]);
    var lastDay = parseInt(last.split('/')[1]);

    //Integer representation of the last day. The first day is represnted as 0
    var lastInt = ((lastMonth - firstMonth) * 30) + (lastDay - firstDay);

    //Draw first date circle
    $("#line").append('<div class="circle" id="circle0" style="left: ' + 0 + '%;"><div class="popupSpan">' + dateSpan(dates[0])  + '</div></div>');
    console.log("{{ eventos_list.0.type }}")

    $("#mainCont").append('<span id="span0" class="center">' + dateSpan(dates[0]) + '</span>');

    //Loop through middle dates
    for (i = 1; i < dates.length - 1; i++) {
      var thisMonth = parseInt(dates[i].split('/')[0]);
      var thisDay = parseInt(dates[i].split('/')[1]);

      //Integer representation of the date
      var thisInt = ((thisMonth - firstMonth) * 30) + (thisDay - firstDay);

      //Integer relative to the first and last dates
      var relativeInt = thisInt / lastInt;

      //Draw the date circle
      $("#line").append('<div class="circle" id="circle' + i + '" style="left: ' + relativeInt * 100 + '%;"><div class="popupSpan">' + dateSpan(dates[i]) + '</div></div>');

      $("#mainCont").append('<span id="span' + i + '" class="right">' + dateSpan(dates[i]) + '</span>');
    }

    //Draw the last date circle
    $("#line").append('<div class="circle" id="circle' + i + '" style="left: ' + 99 + '%;"><div class="popupSpan">' + dateSpan(dates[dates.length - 1]) + '</div></div>');

    $("#mainCont").append('<span id="span' + i + '" class="right">' + dateSpan(dates[i]) + '</span>');
  }

  $(".circle:first").addClass("active");
}

makeCircles();

$(".circle").mouseenter(function() {
  $(this).addClass("hover");
});

$(".circle").mouseleave(function() {
  $(this).removeClass("hover");
});

$(".circle").click(function() {
  var spanNum = $(this).attr("id");
  selectDate(spanNum);
});

function selectDate(selector) {
  $selector = "#" + selector;
  $spanSelector = $selector.replace("circle", "span");
  var current = $selector.replace("circle", "");

  $(".active").removeClass("active");
  $($selector).addClass("active");

  if ($($spanSelector).hasClass("right")) {
    $(".center").removeClass("center").addClass("left")
    $($spanSelector).addClass("center");
    $($spanSelector).removeClass("right")
  } else if ($($spanSelector).hasClass("left")) {
    $(".center").removeClass("center").addClass("right");
    $($spanSelector).addClass("center");
    $($spanSelector).removeClass("left");
  };
};

console.log()


</script>
</body>
</html>
